@page "/PlantDetail/Detail/{id}"
@model Plantpedia.Pages.Plant.DetailsModel
@using System.Security.Claims

@{
    ViewData["Title"] = "Chi tiết cây trồng";
}

@Html.AntiForgeryToken()

@section Styles {
    <link rel="stylesheet" href="~/css/detail-page.css" asp-append-version="true" />
}

<main class="container my-5">
    <!-- Error Alert -->
    <div id="errorAlert" class="alert alert-danger d-none" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorMessage"></span>
    </div>

    <!-- Plant Content -->
    <div id="plantContent" class="d-none">
        <div class="row">
            <!-- Image Gallery -->
            <div class="col-lg-6 mb-4">
                <!-- Breadcrumb moved here, top left of gallery -->
                <nav aria-label="breadcrumb" class="mb-0">
                    <ol class="breadcrumb bg-transparent p-0">
                        <li class="breadcrumb-item">
                            <a href="/" class="text-success">
                                <i class="fas fa-home"></i> Trang chủ
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/plants" class="text-success">Cây trồng</a>
                        </li>
                        <li class="breadcrumb-item active" id="breadcrumbName">Chi tiết</li>
                    </ol>
                </nav>

                <div class="card shadow-sm border-0">
                    <div class="card-body p-3">
                        <img id="mainImage" 
                             src="~/images/placeholder.png" 
                             class="img-fluid rounded main-image" 
                             alt="Ảnh chính">
                    </div>
                </div>
                <div id="thumbnailContainer" class="row g-2 mt-2"></div>
            </div>

            <!-- Plant Information -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body p-4">
                        <h1 id="plantCommonName" class="h2 fw-bold text-dark mb-2"></h1>
                        <p class="text-muted fst-italic mb-3">
                            <i class="fas fa-flask"></i>
                            <span id="plantScientificName"></span>
                        </p>

                        <div id="badgesContainer" class="mb-4"></div>

                        <div class="description-box p-3 bg-light rounded mb-4">
                            <h5 class="text-success mb-3">
                                <i class="fas fa-info-circle"></i> Mô tả
                            </h5>
                            <p id="plantDescription" class="mb-0"></p>
                        </div>

                        <div id="quickInfoContainer" class="row g-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Section -->
        <div class="card shadow-sm border-0 mt-4">
            <div class="card-header bg-white border-0">
                <ul class="nav nav-tabs card-header-tabs" id="plantTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" 
                                id="careTab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#care" 
                                type="button" 
                                role="tab">
                            <i class="fas fa-hand-holding-water"></i> Chăm sóc
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" 
                                id="regionTab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#region" 
                                type="button" 
                                role="tab">
                            <i class="fas fa-map-marked-alt"></i> Vùng trồng
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" 
                                id="soilTab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#soil" 
                                type="button" 
                                role="tab">
                            <i class="fas fa-layer-group"></i> Loại đất
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" 
                                id="climateTab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#climate" 
                                type="button" 
                                role="tab">
                            <i class="fas fa-cloud-sun"></i> Khí hậu
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" 
                                id="usageTab" 
                                data-bs-toggle="tab" 
                                data-bs-target="#usage" 
                                type="button" 
                                role="tab">
                            <i class="fas fa-utensils"></i> Mục đích
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="plantTabsContent">
                    <div class="tab-pane fade show active" id="care" role="tabpanel">
                        <h5 class="text-success mb-4">
                            <i class="fas fa-spa"></i> Hướng dẫn chăm sóc chi tiết
                        </h5>
                        <dl id="careList" class="row mb-0"></dl>
                    </div>
                    <div class="tab-pane fade" id="region" role="tabpanel">
                        <h5 class="text-success mb-3">
                            <i class="fas fa-globe-asia"></i> Vùng trồng phù hợp
                        </h5>
                        <div id="regionContent"></div>
                    </div>
                    <div class="tab-pane fade" id="soil" role="tabpanel">
                        <h5 class="text-success mb-3">
                            <i class="fas fa-mountain"></i> Loại đất thích hợp
                        </h5>
                        <div id="soilContent"></div>
                    </div>
                    <div class="tab-pane fade" id="climate" role="tabpanel">
                        <h5 class="text-success mb-3">
                            <i class="fas fa-temperature-high"></i> Khí hậu phù hợp
                        </h5>
                        <div id="climateContent"></div>
                    </div>
                    <div class="tab-pane fade" id="usage" role="tabpanel">
                        <h5 class="text-success mb-3">
                            <i class="fas fa-tasks"></i> Mục đích sử dụng
                        </h5>
                        <div id="usageContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comments Section -->
        <section class="mt-5" data-plant-id="@Model.PlantId">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <h4 class="mb-4">
                        <i class="fas fa-comments text-success"></i> Bình luận
                    </h4>

                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="card bg-light border-0 mb-4">
                            <div class="card-body">
                                <h5 class="mb-3">
                                    <i class="fas fa-pencil-alt text-success"></i> 
                                    Viết bình luận
                                </h5>
                                <textarea id="commentContent" 
                                          class="form-control mb-3" 
                                          rows="4"
                                          placeholder="Chia sẻ ý kiến, kinh nghiệm của bạn về cây trồng này..."></textarea>
                                <div id="commentError" class="alert alert-danger d-none" role="alert"></div>
                                <button id="btnSubmitComment" class="btn btn-success">
                                    <i class="fas fa-paper-plane"></i> Gửi bình luận
                                </button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="card bg-light border-0 mb-4">
                            <div class="card-body text-center py-5">
                                <i class="fas fa-lock fa-3x text-success mb-3"></i>
                                <h5 class="mb-3">Đăng nhập để bình luận</h5>
                                <p class="text-muted mb-4">
                                    Vui lòng đăng nhập để chia sẻ ý kiến và trao đổi với cộng đồng
                                </p>
                                <a asp-page="/Auth/Login" 
                                   asp-route-ReturnUrl="@(PageContext.HttpContext.Request.Path + PageContext.HttpContext.Request.QueryString)"
                                   class="btn btn-success">
                                    <i class="fas fa-sign-in-alt"></i> Đăng nhập ngay
                                </a>
                            </div>
                        </div>
                    }

                    <div id="commentList"></div>
                </div>
            </div>
        </section>
    </div>
</main>

<!-- Comment Template -->
<template id="commentTemplate">
    <div class="comment-item card border-0 bg-light mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <div class="d-flex align-items-center">
                    <i class="fas fa-user-circle fa-2x text-success me-2"></i>
                    <div>
                        <strong class="comment-author d-block"></strong>
                        <small class="comment-date text-muted"></small>
                    </div>
                </div>
                <button class="btn btn-sm btn-outline-success btn-react" type="button">
                    <i class="fas fa-seedling"></i>
                    <span class="react-count ms-1">0</span>
                </button>
            </div>
            <p class="comment-text mb-2"></p>
            <button class="btn btn-sm btn-link text-success p-0 btn-reply" type="button">
                <i class="fas fa-reply"></i> Trả lời
            </button>
        </div>
    </div>
</template>

@section Scripts {
    <script src="~/js/detail-page.js" asp-append-version="true"></script>
    <script src="~/js/comment.js" asp-append-version="true"></script>
}