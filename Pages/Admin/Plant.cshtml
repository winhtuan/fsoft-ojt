@page
@model Plantpedia.Pages.PlantModel
@{
    Layout = "_Layout-Admin";
    ViewData["Title"] = "Quản lý Cây trồng";
}

<div class="container-fluid">
    <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="">Quản Lý Cây Trồng</h2>
            <div class="d-flex align-items-center">
                <a asp-page="/PlantDetail/UpdatePlant" class="btn btn-teal">
                    <i class="fas fa-seedling"></i> Thêm cây mới
                </a>
            </div>
        </div>

        <form method="get" asp-page="/Admin/Plant">
            <div
                class="filter-container mb-3 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">

                <div class="filter-section mb-4">
                    <!-- Hàng 1: Thanh tìm kiếm -->
                    <div class="row mb-3">
                        <div class="col-12 d-flex align-items-center gap-4">
                            <div class="search-box col-6">
                                <span class="search-icon">
                                    <i class="fas fa-search"></i>
                                </span>

                                <input asp-for="Keywords" class="form-control search-input"
                                    placeholder="Tìm kiếm cây theo tên, mô tả..." />
                            </div>

                            <div class="action-buttons col-6 d-flex gap-2">
                                <button type="submit" class="btn btn-teal">Tìm kiếm</button>
                                <a asp-page="/Admin/Plant" class="btn btn-outline-secondary" data-bs-toggle="tooltip"
                                    title="Làm mới bộ lọc">
                                    <i class="fa-solid fa-arrows-rotate"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Hàng 2: Các dropdown bộ lọc -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex flex-wrap gap-3">
                                @foreach (var innerDropdown in Model.FilterDropdowns)
                                {
                                    <input type="hidden" name="@innerDropdown.Name" id="filter-@innerDropdown.Name"
                                        value="@Request.Query[innerDropdown.Name]" />
                                    <partial name="_DropdownPartial" model="innerDropdown" />
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Tên cây</th>
                    <th>Loại cây</th>
                    <th>Loại đất</th>
                    <th>Khí hậu</th>
                    <th>Khu Vực</th>
                    <th>Ngày thêm</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="plantTable">
                <partial name="_ListPlantPartial" model="Model.Plants" />
            </tbody>
        </table>

        <div id="paginationContainer" class="d-flex justify-content-center">
            <partial name="_Paging" model="Model.Paging" />
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/dashboard.js" asp-append-version="true"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.filter-option').forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    var filterName = btn.getAttribute('data-filter-name');
                    var filterValue = btn.getAttribute('data-filter-value');

                    // Cập nhật input ẩn
                    document.getElementById('filter-' + filterName).value = filterValue;

                    // Cập nhật văn bản của nút dropdown
                    btn.closest('.dropdown').querySelector('.btn-filter').textContent = btn.textContent;
                });
            });

            document.querySelectorAll('input[type="hidden"][id^="filter-"]').forEach(function (hiddenInput) {
                const selectedValue = hiddenInput.value;

                if (selectedValue) {
                    const filterName = hiddenInput.name;

                    const selectedOption = document.querySelector(`.filter-option[data-filter-name='${filterName}'][data-filter-value='${selectedValue}']`);

                    if (selectedOption) {
                        // Tìm nút bấm của dropdown cha và cập nhật lại văn bản
                        const dropdownButton = selectedOption.closest('.dropdown').querySelector('.btn-filter');
                        if (dropdownButton) {
                            dropdownButton.textContent = selectedOption.textContent;
                        }
                    }
                }
            });
        });
    </script>
}